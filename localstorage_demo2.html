{extend name="public:gene" /} {block name="header"} 项目检测申请单 {/block} {block name="content"}
<style type="text/css">
    body {
        padding: 69px 16px 44px;
        box-sizing: border-box;
    }
</style>

<div class="taf-form-box-01">

    <div class="form-tips">

        受检人信息

    </div>

    <form method="GET" action="saveInfo">

        <div class="form-item">

            <div class="item-name">

                订单号：

            </div>

            <div class="item-content">

                <input type="text" id="order_id" name="order_id" readonly value="{$orderNum}">

            </div>

        </div>

        <div class="form-item">

            <div class="item-name">

                姓名

            </div>

            <div class="item-content">

                <input type="text" id="nameInput" name="name" value="" placeholder="请输入姓名">

            </div>

        </div>

        <div class="form-item">

            <div class="item-name">

                生日

            </div>

            <div class="item-content">
                <input type="date" id="ageInput" name="birthdate">
            </div>

        </div>

        <div class="form-item">

            <div class="item-name">
                性别
            </div>


            <div class="item-content">
                <label class="single-select">
                    <input type="radio" name="gender" value="男" checked>
                    <i class="iconfont active">&#xe60f;</i>
                    <span>男</span>
                </label>

                <label class="single-select">
                    <input type="radio" name="gender" value="女">
                    <i class="iconfont">&#xe60f;</i>
                    <span>女</span>
                </label>
            </div>
        </div>

        <div class="form-item">

            <div class="item-name">

                身高

            </div>

            <div class="item-content">

                <input type="text" id="heightInput" name="height" value="" placeholder="请输入身高">

                <span>cm</span>

            </div>

        </div>

        <div class="form-item">

            <div class="item-name">

                体重

            </div>

            <div class="item-content">
                <input type="text" id="weightInput" name="weight" value="" placeholder="请输入体重">
                <span>kg</span>
            </div>
        </div>

        <div class="form-item">
            <div class="item-name">
                身份证号
            </div>
            <div class="item-content">
                <input type="text" id="idInput" name="idnumber" value="" placeholder="请输入身份证号 ">
            </div>
        </div>

        <div class="form-item">

            <div class="item-name">

                吸烟史

            </div>

            <div class="item-content">

                <label class="single-select">

                    <input type="radio" name="smoking" value="是">

                    <i class="iconfont">&#xe60f;</i>

                    <span>是</span>

                </label>

                <label class="single-select">

                    <input type="radio" name="smoking" value="否" checked>

                    <i class="iconfont active">&#xe60f;</i>

                    <span>否</span>

                </label>

            </div>

        </div>

        <div class="form-item">

            <div class="item-name">

                饮酒史

            </div>

            <div class="item-content">

                <label class="single-select">

                    <input type="radio" name="drinking" value="是">

                    <i class="iconfont">&#xe60f;</i>

                    <span>是</span>

                </label>

                <label class="single-select">

                    <input type="radio" name="drinking" value="否" checked>

                    <i class="iconfont active">&#xe60f;</i>

                    <span>否</span>

                </label>

            </div>

        </div>

    </form>

</div>

<div class="taf-form-box-02">

    <div class="form-tips">

        受检者的直系亲属中：

    </div>

    <form action="">

        <div class="form-item">

            <label class="single-select">

                <input type="radio" name="fam_crc_history" value="是">

                <i class="iconfont">&#xe60f;</i>

                <span>是</span>

            </label>

            <label class="single-select">

                <input type="radio" name="fam_crc_history" value="否" checked>

                <i class="iconfont active">&#xe60f;</i>

                <span>否</span>

            </label>

            <span>结直肠癌史</span>

        </div>

        <div class="form-item">

            <label class="single-select">

                <input type="radio" name="fam_other_cancer_history" value="是">

                <i class="iconfont">&#xe60f;</i>

                <span>是</span>

            </label>

            <label class="single-select">

                <input type="radio" name="fam_other_cancer_history" value="否" checked>

                <i class="iconfont active">&#xe60f;</i>

                <span>否</span>

            </label>

            <span>家族其他成员癌症史</span>

        </div>

    </form>

</div>

<div class="taf-form-box-03">
    <div class="form-tips">
        采血时，受检者本人：
    </div>
    <form action="">
        <div class="form-item">
            <label class="single-select">
                <input type="radio" name="pregnancy" value="是">
                <i class="iconfont">&#xe60f;</i>
                <span>是</span>
            </label>

            <label class="single-select">
                <input type="radio" name="pregnancy" value="否" checked>
                <i class="iconfont active">&#xe60f;</i>
                <span>否</span>
            </label>
            <span>处于孕期</span>
        </div>

        <div class="form-item">

            <label class="single-select">

                <input type="radio" name="diabetes" value="是">

                <i class="iconfont">&#xe60f;</i>

                <span>是</span>

            </label>

            <label class="single-select">

                <input type="radio" name="diabetes" value="否" checked>

                <i class="iconfont active">&#xe60f;</i>

                <span>否</span>

            </label>

            <span>糖尿病</span>

        </div>

        <div class="form-item item-txt">

            <div class="item-row-01">

                <label class="single-select">

                    <input type="radio" name="crc_history" value="是">

                    <i class="iconfont">&#xe60f;</i>

                    <span>是</span>

                </label>

                <label class="single-select">

                    <input type="radio" name="crc_history" value="否" checked>

                    <i class="iconfont active">&#xe60f;</i>

                    <span>否</span>

                </label>

                <span>结肠癌病史</span>

            </div>

            <div class="item-row-02">

                <textarea placeholder="如有,请填写你的病史说明" id="colon-cancer"></textarea>

            </div>



        </div>

        <div class="form-item item-txt">

            <div class="item-row-01">

                <label class="single-select">

                    <input type="radio" name="other_disease_desc" value="是">

                    <i class="iconfont">&#xe60f;</i>

                    <span>是</span>

                </label>

                <label class="single-select">

                    <input type="radio" name="other_disease_desc" value="否" checked>

                    <i class="iconfont active">&#xe60f;</i>

                    <span>否</span>

                </label>

                <span>其他病史</span>

            </div>

            <div class="item-row-02">

                <textarea placeholder="如有,请填写你的病史说明" id="colon-cancer"></textarea>

            </div>



        </div>



        <div class="form-item item-txt">

            <div class="item-row-01">

                <label class="single-select">

                    <input type="radio" name="chronic_gitd_history" value="是">

                    <i class="iconfont">&#xe60f;</i>

                    <span>是</span>

                </label>

                <label class="single-select">

                    <input type="radio" name="chronic_gitd_history" value="否" checked>

                    <i class="iconfont active">&#xe60f;</i>

                    <span>否</span>

                </label>

                <span>慢性消化道疾病</span>

            </div>

            <div class="item-row-02">

                <textarea placeholder="如有,请填写你的病史说明" id="digestive-tract-diseases"></textarea>

            </div>



        </div>

        <div class="form-item item-txt">
            <div class="item-row-01">
                <label class="single-select">
                    <input type="radio" name="medication" value="是">
                    <i class="iconfont">&#xe60f;</i>
                    <span>是</span>
                </label>
                <label class="single-select">
                    <input type="radio" name="medication" value="否" checked>
                    <i class="iconfont active">&#xe60f;</i>
                    <span>否</span>
                </label>
                <span>正在服药</span>
            </div>
            <div class="item-row-02">
                <textarea placeholder="如有,请填写你的病史说明" id="taking-medicine"></textarea>
            </div>
        </div>
    </form>
</div>

<div class="taf-form-box-04">

    <div class="form-tips">

        采血时，受检者本人是否存在，可多选：

    </div>

    <form action="">

        <div class="form-item">

            <label class="check-box">

                <input type="checkbox" name="user_fx" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                慢性腹泻

            </label>

        </div>

        <div class="form-item">

            <label class="check-box">

                <input type="checkbox" name="user_bm" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                慢性便秘

            </label>

        </div>

        <div class="form-item">

            <label class="check-box">

                <input type="checkbox" name="user_lyxb" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                黏液血便

            </label>

        </div>

        <div class="form-item">

            <label class="check-box">

                <input type="checkbox" name="user_mxdly" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                慢性胆囊炎或手术史

            </label>

        </div>

        <div class="form-item">

            <label class="check-box">

                <input type="checkbox" name="user_lwy" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                慢性阑尾炎或切除史

            </label>

        </div>

        <div class="form-item">

            <label class="check-box">

                <input type="checkbox" name="user_sgnyc" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                肾功能异常

            </label>

        </div>

        <div class="form-item">

            <label class="check-box">

                <input type="checkbox" name="user_cdxrs" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                肠道息肉史

            </label>

        </div>

        <div class="form-item">

            <label class="check-box">

                <input type="checkbox" name="user_ggnyc" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                肝功能异常

            </label>

        </div>

        <div class="form-item">

            <label class="check-box">

                <input type="checkbox" name="user_cqjsyy" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                长期精神压抑

            </label>

        </div>

        <div class="form-item">

            <label class="check-box">

                <input type="checkbox" name="user_jzx" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                结节或肿物（甲状腺/肺/腹部）

            </label>

        </div>

        <div class="form-item">

            <label class="check-box">

                <input type="checkbox" name="user_sgnyc" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                肾功能异常

            </label>

        </div>

        <div class="form-item other-diseases">

            <label class="check-box">

                <input type="checkbox" name="user_yzjb" value="是">

                <img src="__GENE__/img/ok1.png" alt="">

                其他器官严重疾病

            </label>

            <textarea placeholder="如有,请说明" id="other-diseases"></textarea>

        </div>



        <input type="hidden" id='hidden_id' name="card_id" value="{$id}">


        <div class="save-btn-box">

            <button class="save-btn" style="width:100%;">

                保存本页

            </button>

        </div>
    </form>


</div>



<script>
    $(function () {
        /* 获取缓存数据 start */
        var key = $("#order_id").val().trim();
        var str = localStorage.getItem(key);
        console.log(str);
        if (str!=null) {
            var obj = JSON.parse(str);
            $(".form-item").eq(1).find(".item-content input").val(obj.name);
            $(".form-item").eq(2).find(".item-content input").val(obj.age);
            $(".form-item").eq(3).find(".item-content input").eq(obj.sex).prop("checked", true);
            $(".form-item").eq(4).find(".item-content input").val(obj.height);
            $(".form-item").eq(5).find(".item-content input").val(obj.weight);
            $(".form-item").eq(6).find(".item-content input").val(obj.id);
            $(".form-item").eq(7).find("input").eq(obj.smoking).prop("checked", true);
            $(".form-item").eq(8).find("input").eq(obj.drinking).prop("checked", true);
            $(".form-item").eq(9).find("input").eq(obj.jzc).prop("checked", true);
            $(".form-item").eq(10).find("input").eq(obj.azs).prop("checked", true);
            $(".form-item").eq(11).find("input").eq(obj.yq).prop("checked", true);
            $(".form-item").eq(12).find("input").eq(obj.tnb).prop("checked", true);
            $(".form-item").eq(13).find("input").eq(obj.jca).prop("checked", true);
            $(".form-item").eq(13).find("textarea").val(obj.desc01);
            $(".form-item").eq(14).find("input").eq(obj.qtbs).prop("checked", true);
            $(".form-item").eq(14).find("textarea").val(obj.desc02);
            $(".form-item").eq(15).find("input").eq(obj.mxxhd).prop("checked", true);
            $(".form-item").eq(15).find("textarea").val(obj.desc03);
            $(".form-item").eq(16).find("input").eq(obj.fy).prop("checked", true);
            $(".form-item").eq(16).find("textarea").val(obj.desc04);
            $(".other-diseases").find("textarea").val(obj.desc05);
            for (var i = 0; i < obj.disease.length; i++) {
                $(".check-box input").eq(obj.disease[i]).prop("checked", true);
            }
            //单选复选 选中样式
            $(".single-select input").each(function (index) {
                if ($(this).prop("checked") == true) {
                    $(this).siblings(".iconfont").addClass("active");
                    $(this).parent().siblings(".single-select").find(".iconfont").removeClass("active");
                }
            })
            $(".check-box input").each(function (index) {
                if ($(this).prop("checked") == true) {

                    $(this).siblings("img").addClass("active");

                } else {

                    $(this).siblings("img").removeClass("active");

                }

            })
        }
        /* 获取缓存数据 end */

        /* 缓存用户输入 start*/
        $(window).on("unload", function () {
            // 页面重载也会触发unload事件
            // key = $("#order_id").val().trim();
            var obj = {};
            // 获取所有的用户输入内容--单选 复选获取index值
            obj.name = $(".form-item").eq(1).find(".item-content input").val().trim();
            obj.age = $(".form-item").eq(2).find(".item-content input").val().trim();
            obj.sex = $(".form-item").eq(3).find(".item-content .active").parent().index();
            obj.height = $(".form-item").eq(4).find(".item-content input").val().trim();
            obj.weight = $(".form-item").eq(5).find(".item-content input").val().trim();
            obj.id = $(".form-item").eq(6).find(".item-content input").val().trim();
            obj.smoking = $(".form-item").eq(7).find(".item-content .active").parent().index();
            obj.drinking = $(".form-item").eq(8).find(".item-content .active").parent().index();
            obj.jzc = $(".form-item").eq(9).find(".active").parent().index();
            obj.azs = $(".form-item").eq(10).find(".active").parent().index();
            obj.yq = $(".form-item").eq(11).find(".active").parent().index();
            obj.tnb = $(".form-item").eq(12).find(".active").parent().index();
            obj.jca = $(".form-item").eq(13).find(".active").parent().index();
            obj.desc01 = $(".form-item").eq(13).find(".item-row-02 textarea").val().trim();
            obj.qtbs = $(".form-item").eq(14).find(".active").parent().index();
            obj.desc02 = $(".form-item").eq(14).find(".item-row-02 textarea").val().trim();
            obj.mxxhd = $(".form-item").eq(15).find(".active").parent().index();
            obj.desc03 = $(".form-item").eq(15).find(".item-row-02 textarea").val().trim();
            obj.fy = $(".form-item").eq(16).find(".active").parent().index();
            obj.desc04 = $(".form-item").eq(16).find(".item-row-02 textarea").val().trim();
            obj.disease = [];
            $(".check-box input").each(function (index) {
                if ($(this).prop("checked") == true) {
                    obj.disease.push(index);
                }
            });
            obj.desc05 = $(".other-diseases").find("textarea").val().trim();

            obj = JSON.stringify(obj);
            localStorage.setItem(key, obj);
            flag=true;
        })
        /* 缓存用户输入 end*/

        // 验证姓名

        function isName(name) {

            var pattern = /^[\u4E00-\u9FA5\uf900-\ufa2d·s]{2,20}$/;

            return pattern.test(name);

        }

        // 验证年龄 0~99岁

        function isAge(age) {

            var pattern = /^\d{1,2}$/;

            return pattern.test(age);

        }

        // 验证性别

        function isSex(sex) {

            var pattern = /^(男|女)$/;

            return pattern.test(sex);

        }

        // 验证身高

        function isHeight(height) {

            var pattern = /^\d{1,3}$/;

            return pattern.test(height);

        }

        // 验证体重

        function isWeight(weight) {

            var pattern = /^\d{1,3}$/;

            return pattern.test(weight);

        }

        // 验证手机号

        function isPhoneNo(phone) {

            var pattern = /^1[34578]\d{9}$/;

            return pattern.test(phone);

        }

        // 验证身份证

        function isCardNo(card) {

            var pattern = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;

            return pattern.test(card);

        }



        //输入框失焦验证输入函数封装

        function checkOut(input, reg, text) {

            input.on("blur", function () {

                if (reg.test(input.val().trim())) {

                    return false;

                } else {

                    alert_box("tc-tfp-btx", text);

                }

            });

        }

        $(".save-btn").on("click", function () {
            var value_1 = $("#nameInput").val().trim();
            var value_2 = $("#ageInput").val().trim();
            var value_4 = $("#heightInput").val().trim();
            var value_5 = $("#weightInput").val().trim();
            var value_6 = $("#idInput").val().trim();
            if (value_1 == "" || value_2 == "" || value_4 == "" || value_5 == "" || value_6 == "") {
                alert_box("tc-tfp-btx", "请完善必填项！");
                return false;
            } else if (!isName(value_1)) {
                alert_box("tc-tfp-btx", "姓名输入有误，请重新输入！");
                return false;
            } else if (!isHeight(value_4)) {
                alert_box("tc-tfp-btx", "请输入真实的身高！");
                return false;

            } else if (!isWeight(value_5)) {
                alert_box("tc-tfp-btx", "请输入真实的体重！");
                return false;
            } else if (!isCardNo(value_6)) {
                alert_box("tc-tfp-btx", "请输入真实的身份证号！");
                return false;
            }

            var d = {};
            var t = $('form').serializeArray();
            $.each(t, function () {
                d[this.name] = this.value;
            });

            $.post("/mobile/card/userInfoPost", d, function (result) {
                if (result.code !== 0) {
                    alert_box("tc-tto-tel", result.message, "", function () {
                        localStorage.removeItem(key);//移除缓存数据项
                        $(window).off("unload");//移除unload事件处理程序
                        $("form").each(function(index){
                            $(this).get(0).reset();
                        })
                        location.assign("/mobile/card/cjwc.html?id=" + $('#hidden_id').val());
                    })
                } else {
                    alert_box("tc-tto-tel", result.message, "", function () {
                        onec_click = 0;
                    })
                }
            });
            return false;
        });



        $(".single-select input").on("click", function () {

            $(this).siblings(".iconfont").addClass("active");

            $(this).parent().siblings(".single-select").find(".iconfont").removeClass("active");

            console.log($(this).prop("checked"));

            console.log($(this).parent().siblings(".single-select").find("input").prop("checked"));

        });



        //多选按钮选中状态切换

        $(".check-box input").on("click", function () {

            console.log("1111");

            if ($(this).prop("checked") == true) {

                $(this).siblings("img").addClass("active");

            } else {

                $(this).siblings("img").removeClass("active");

            }

        });



    });
</script>



{/block}